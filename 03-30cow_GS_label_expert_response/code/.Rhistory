library(lubridate)
library(irr)
gs_p1 <- read.csv("../results/gs_response_Aug-12-2023.csv", header = TRUE)
gs_p2 <- read.csv("../results/gs_response_Wali_Jul-10-2023.csv", header = TRUE)
gs_p3 <- read.csv("../results/gs_response_Wali_Jul-14-2023.csv", header = TRUE)
gs_p4 <- read.csv("../results/gs_response_Wali_Jul-18-2023.csv", header = TRUE)
gs_p5 <- read.csv("../results/gs_response_Sep-10-2023.csv", header = TRUE)
gs <- rbind(gs_p1, gs_p2)
gs <- rbind(gs, gs_p3)
gs <- rbind(gs, gs_p4)
gs <- rbind(gs, gs_p5)
#########
View(gs)
unique(gs$Worker_id)
gs <- gs[which(gs$Worker_id != "SB"),]
unique(gs$Worker_id)
View(gs_p5)
library(lubridate)
library(irr)
gs_p1 <- read.csv("../results/gs_response_Aug-12-2023.csv", header = TRUE)
gs_p2 <- read.csv("../results/gs_response_Wali_Jul-10-2023.csv", header = TRUE)
gs_p3 <- read.csv("../results/gs_response_Wali_Jul-14-2023.csv", header = TRUE)
gs_p4 <- read.csv("../results/gs_response_Wali_Jul-18-2023.csv", header = TRUE)
gs_p5 <- read.csv("../results/gs_response_Sep-10-2023.csv", header = TRUE)
gs <- rbind(gs_p1, gs_p2)
gs <- rbind(gs, gs_p3)
gs <- rbind(gs, gs_p4)
gs <- rbind(gs, gs_p5)
# remove worker "SB" as she used a different lameness assessment method than the other workers
gs <- gs[which(gs$Worker_id != "SB"),]
unique(gs$Worker_id)
######################## GS average processing #################################
# take the avearge across all experts for each cow
gs_avg <- aggregate(gs$GS, by = list(gs$Cow), FUN = mean)
colnames(gs_avg) <- c("Cow", "GS")
View(gs_avg)
###################### intraobserver reliability ###############################
# you can only calculate intraobserver reliability if the expert answered >=2 times
temp <- gs[which(gs$Cow == 4008),]
expert_retain <- unique(temp$Worker_id[duplicated(temp$Worker_id)])
gs_retain <- gs[which(gs$Worker_id %in% expert_retain),]
gs_retain <- gs_retain[, c("Cow", "Worker_id", "GS_round", "GS")]
# calculate intraobserver reliability using iCC
# Get the unique worker IDs
workers <- unique(gs_retain$Worker_id)
# Initialize an empty vector to store the ICC for each worker
icc_values <- numeric(length(workers))
# Loop over each unique worker
for (i in seq_along(workers)) {
# Subset the data for the current worker
worker_data <- gs_retain[gs_retain$Worker_id == workers[i], ]
# Reshape the data to wide format, with one row per cow and one column per observation
worker_data_wide <- reshape(worker_data, idvar = c("Worker_id", "Cow"), timevar = "GS_round", direction = "wide")
# Calculate the ICC for the current worker
icc_result <- icc(worker_data_wide[, 3:ncol(worker_data_wide)],model = "twoway", type = "agreement", unit = "single")
# Store the ICC value
icc_values[i] <- icc_result$value
}
# Combine the worker IDs and ICC values into a data frame
icc_df <- data.frame(Worker_id = workers, ICC = icc_values)
###################### interobserver reliability ###############################
gs_retain2 <- gs[which(gs$GS_round == 1),]
gs_retain2 <- gs_retain2[, c("Cow", "Worker_id", "GS")]
# change data orientation
worker_data_wide_inter <- reshape(gs_retain2, idvar = c("Cow"), timevar = "Worker_id", direction = "wide")
# Calculate the ICC for the current worker
icc_result_inter <- icc(worker_data_wide_inter[, 2:ncol(worker_data_wide_inter)],model = "twoway", type = "agreement", unit = "single")
icc_values_inter <- icc_result_inter$value  # 0.4529184
icc_values_inter
View(worker_data_wide)
View(gs_retain)
View(temp)
expert_retain
View(worker_data_wide)
View(icc_df)
gs_retain2 <- gs[which(gs$GS_round == 1),]
gs_retain2 <- gs_retain2[, c("Cow", "Worker_id", "GS")]
# change data orientation
worker_data_wide_inter <- reshape(gs_retain2, idvar = c("Cow"), timevar = "Worker_id", direction = "wide")
View(worker_data_wide_inter)
# Calculate the ICC for the current worker
icc_result_inter <- icc(worker_data_wide_inter[, 2:ncol(worker_data_wide_inter)],model = "twoway", type = "agreement", unit = "single")
icc_values_inter <- icc_result_inter$value  # 0.4529184
icc_values_inter
icc_mean <- mean(icc_df$ICC)
icc_sd <- sd(icc_df$ICC)
icc_mean
icc_sd
write.csv(gs, file = "../results/gs_response_combined.csv")
write.csv(gs_avg, file = "../results/gs_response_combined_avg.csv")
write.csv(icc_df, file = "../results/intraobserver_reliability.csv")
View(worker_data_wide_inter)
5*3*30
library(lubridate)
library(irr)
library(lubridate)
library(irr)
gs_p1 <- read.csv("../results/gs_response_Aug-12-2023.csv", header = TRUE)
gs_p2 <- read.csv("../results/gs_response_Wali_Jul-10-2023.csv", header = TRUE)
gs_p3 <- read.csv("../results/gs_response_Wali_Jul-14-2023.csv", header = TRUE)
gs_p4 <- read.csv("../results/gs_response_Wali_Jul-18-2023.csv", header = TRUE)
gs_p5 <- read.csv("../results/gs_response_Sep-10-2023.csv", header = TRUE)
gs <- rbind(gs_p1, gs_p2)
gs <- rbind(gs, gs_p3)
gs <- rbind(gs, gs_p4)
gs <- rbind(gs, gs_p5)
# remove worker "SB" as she used a different lameness assessment method than the other workers
gs <- gs[which(gs$Worker_id != "SB"),]
######################## GS average processing #################################
# take the avearge across all experts for each cow
gs_avg <- aggregate(gs$GS, by = list(gs$Cow), FUN = mean)
colnames(gs_avg) <- c("Cow", "GS")
###################### intraobserver reliability ###############################
# you can only calculate intraobserver reliability if the expert answered >=2 times
temp <- gs[which(gs$Cow == 4008),]
expert_retain <- unique(temp$Worker_id[duplicated(temp$Worker_id)])
gs_retain <- gs[which(gs$Worker_id %in% expert_retain),]
gs_retain <- gs_retain[, c("Cow", "Worker_id", "GS_round", "GS")]
# calculate intraobserver reliability using iCC
# Get the unique worker IDs
workers <- unique(gs_retain$Worker_id)
# Initialize an empty vector to store the ICC for each worker
icc_values <- numeric(length(workers))
# Loop over each unique worker
for (i in seq_along(workers)) {
# Subset the data for the current worker
worker_data <- gs_retain[gs_retain$Worker_id == workers[i], ]
# Reshape the data to wide format, with one row per cow and one column per observation
worker_data_wide <- reshape(worker_data, idvar = c("Worker_id", "Cow"), timevar = "GS_round", direction = "wide")
# Calculate the ICC for the current worker
icc_result <- icc(worker_data_wide[, 3:ncol(worker_data_wide)],model = "twoway", type = "agreement", unit = "single")
# Store the ICC value
icc_values[i] <- icc_result$value
}
# Combine the worker IDs and ICC values into a data frame
icc_df <- data.frame(Worker_id = workers, ICC = icc_values)
icc_mean <- mean(icc_df$ICC)
icc_sd <- sd(icc_df$ICC)
icc_mean
min(icc_df$ICC)
max(icc_df$ICC)
icc_sd
source("combine_5experts_rating_helper.R")
View(gs)
rounds <- unique(gs$GS_round)
for (r in rounds) {print(r)}
interobserver_ICC_per_round <- function(gs, round) {
gs_retain2 <- gs[which(gs$GS_round == round),]
gs_retain2 <- gs_retain2[, c("Cow", "Worker_id", "GS")]
# change data orientation
worker_data_wide_inter <- reshape(gs_retain2, idvar = c("Cow"), timevar = "Worker_id", direction = "wide")
# Calculate the ICC for the current worker
icc_result_inter <- icc(worker_data_wide_inter[, 2:ncol(worker_data_wide_inter)],model = "twoway", type = "agreement", unit = "single")
icc_values_inter <- icc_result_inter$value
return(icc_values_inter)
}
interobserver_ICC_per_round_df <- function(gs) {
rounds <- unique(gs$GS_round)
for (r in rounds) {
icc_values_inter <- interobserver_ICC_per_round(gs, r)
temp <- data.frame(GS_round = r, interobserver_ICC = icc_values_inter)
if (r == 1) {
df <- temp
} else {
df <- rbind(df, temp)
}
}
return(df)
}
inter_ICC_by_rounds <- interobserver_ICC_per_round_df(gs)
View(inter_ICC_by_rounds)
mean(inter_ICC_by_rounds$interobserver_ICC)
sd(inter_ICC_by_rounds$interobserver_ICC)
######################## then calculate interobserver ##########################
score_avg_by_expert <- aggregate(gs$GS, by = list(gs$Cow, gs$Worker_id), FUN = mean)
View(score_avg_by_expert)
score_avg_by_expert <- aggregate(gs$GS, by = list(gs$Cow, gs$Worker_id), FUN = mean)
colnames(score_avg_by_expert) <- c("Cow", "Worker_id", "GS")
score_avg_by_expert <- aggregate(gs$GS, by = list(gs$Cow, gs$Worker_id), FUN = mean)
colnames(score_avg_by_expert) <- c("Cow", "Worker_id", "GS")
inter_ICC_by_avg_score <- interobserver_ICC_per_round(score_avg_by_expert)
source("combine_5experts_rating_helper.R")
score_avg_by_expert <- aggregate(gs$GS, by = list(gs$Cow, gs$Worker_id), FUN = mean)
colnames(score_avg_by_expert) <- c("Cow", "Worker_id", "GS")
inter_ICC_by_avg_score <- interobserver_ICC_per_round(score_avg_by_expert)
inter_ICC_by_avg_score
View(gs_avg)
write.csv(inter_ICC_by_rounds, file = "../results/interobserver_reliability_by_rounds.csv")
set.seed(7)
num_of_rounds = 1
num_of_experts = 1
all_rounds <- unique(gs$GS_round)
all_experts <- unique(gs$Worker_id)
selected_rounds <- sample(all_rounds, num_of_rounds)
selected_experts <- sample(all_experts, num_of_experts)
selected_rounds
selected_experts
gs_sampled <- gs[which((gs$Worker_id %in% selected_experts) & (gs$GS_round %in% selected_rounds))]
gs_sampled <- gs[which((gs$Worker_id %in% selected_experts) & (gs$GS_round %in% selected_rounds)),]
View(gs_sampled)
View(gs_avg)
num_of_experts = 2
all_rounds <- unique(gs$GS_round)
all_experts <- unique(gs$Worker_id)
selected_rounds <- sample(all_rounds, num_of_rounds)
selected_experts <- sample(all_experts, num_of_experts)
gs_sampled <- gs[which((gs$Worker_id %in% selected_experts) & (gs$GS_round %in% selected_rounds)),]
selected_rounds
selected_experts
View(gs_sampled)
length(unique(gs$Worker_id))
r = 1
gs_retain2 <- gs[which(gs$GS_round == r),]
gs_retain2 <- gs_retain2[, c("Cow", "Worker_id", "GS")]
# change data orientation
worker_data_wide_inter <- reshape(gs_retain2, idvar = c("Cow"), timevar = "Worker_id", direction = "wide")
View(worker_data_wide_inter)
icc_change_rounds_expert_num(gs)
source("combine_5experts_rating_helper.R")
################# from full set of 5 assessor & 3 rounds #######################
set.seed(7)
icc_change_df <- icc_change_rounds_expert_num(gs)
View(icc_change_df)
source("combine_5experts_rating_helper.R")
set.seed(7)
icc_change_df <- icc_change_rounds_expert_num(gs)
View(icc_change_df)
source("combine_5experts_rating_helper.R")
set.seed(7)
icc_change_df <- icc_change_rounds_expert_num(gs)
View(icc_change_df)
source("combine_5experts_rating_helper.R")
set.seed(7)
icc_change_df <- icc_change_rounds_expert_num(gs)
str(icc_change_df)
write.csv(icc_change_df, file = "../results/icc_change_by_round_expert_num.csv")
